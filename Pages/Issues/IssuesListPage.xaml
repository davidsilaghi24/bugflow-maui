<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BugFlow.Pages.Issues.IssuesListPage"
             Title="Issue-uri"
             BackgroundColor="{StaticResource PageBackground}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Adauga" Clicked="OnAdaugaClicked" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto, *">
        <SearchBar x:Name="searchBar" Placeholder="Cauta issue..."
                   TextChanged="OnSearchTextChanged"
                   CancelButtonColor="{StaticResource Primary}"
                   BackgroundColor="{StaticResource CardBackground}" />

        <ActivityIndicator x:Name="loadingIndicator" Grid.Row="1"
                           IsRunning="False" IsVisible="False"
                           Color="{StaticResource Primary}"
                           VerticalOptions="Center" HorizontalOptions="Center"
                           HeightRequest="50" WidthRequest="50" />

        <VerticalStackLayout x:Name="emptyState" Grid.Row="1"
                             IsVisible="False"
                             VerticalOptions="Center" HorizontalOptions="Center"
                             Spacing="8" Padding="30">
            <Label Text="&#x1F41B;" FontSize="48" HorizontalTextAlignment="Center" />
            <Label Text="Nu exista inca issue-uri" FontSize="18" FontAttributes="Bold"
                   TextColor="{StaticResource Gray600}" HorizontalTextAlignment="Center" />
            <Label Text="Apasa Adauga pentru a raporta un issue."
                   FontSize="14" TextColor="{StaticResource Gray400}" HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" x:Name="refreshView" Refreshing="OnRefreshing">
            <ListView x:Name="listView"
                      HasUnevenRows="True"
                      ItemSelected="OnItemSelected"
                      SeparatorVisibility="None"
                      BackgroundColor="Transparent">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Frame Margin="12,6" Padding="0" CornerRadius="12"
                                   BackgroundColor="{StaticResource CardBackground}"
                                   BorderColor="Transparent" HasShadow="True">
                                <Grid Padding="16,14" ColumnDefinitions="4, *, Auto" ColumnSpacing="14">
                                    <BoxView CornerRadius="2"
                                             Color="{Binding Prioritate, Converter={StaticResource PriorityColorConverter}}"
                                             VerticalOptions="Fill" />
                                    <VerticalStackLayout Grid.Column="1" Spacing="4">
                                        <Label Text="{Binding Titlu}" FontSize="16" FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}" />
                                        <Label Text="{Binding Descriere}" FontSize="13"
                                               TextColor="{StaticResource Gray500}"
                                               LineBreakMode="TailTruncation" MaxLines="1" />
                                        <Label Text="{Binding DataEstimata, StringFormat='Estimat: {0:dd MMM yyyy}'}"
                                               FontSize="11" TextColor="{StaticResource Gray400}" />
                                    </VerticalStackLayout>
                                    <VerticalStackLayout Grid.Column="2" VerticalOptions="Center" Spacing="4"
                                                         HorizontalOptions="End">
                                        <Frame Padding="8,3" CornerRadius="10" BorderColor="Transparent"
                                               BackgroundColor="{Binding Prioritate, Converter={StaticResource PriorityColorConverter}}">
                                            <Label Text="{Binding Prioritate, Converter={StaticResource PrioritateToStringConverter}}" FontSize="11" TextColor="White" />
                                        </Frame>
                                        <Frame Padding="8,3" CornerRadius="10" BorderColor="{StaticResource SurfaceBorder}"
                                               BackgroundColor="Transparent">
                                            <Label Text="{Binding Status, Converter={StaticResource StatusIssueToStringConverter}}" FontSize="11"
                                                   TextColor="{StaticResource Gray600}" />
                                        </Frame>
                                    </VerticalStackLayout>
                                </Grid>
                            </Frame>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </RefreshView>
    </Grid>
</ContentPage>
