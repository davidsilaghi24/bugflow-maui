<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="BugFlow.Pages.Membri.MembriListPage"
             Title="Echipa"
             BackgroundColor="{StaticResource PageBackground}">

    <ContentPage.ToolbarItems>
        <ToolbarItem Text="Adauga" Clicked="OnAdaugaClicked" />
    </ContentPage.ToolbarItems>

    <Grid RowDefinitions="Auto, *">
        <SearchBar x:Name="searchBar" Placeholder="Cauta membru..."
                   TextChanged="OnSearchTextChanged"
                   CancelButtonColor="{StaticResource Primary}"
                   BackgroundColor="{StaticResource CardBackground}" />

        <ActivityIndicator x:Name="loadingIndicator" Grid.Row="1"
                           IsRunning="False" IsVisible="False"
                           Color="{StaticResource Primary}"
                           VerticalOptions="Center" HorizontalOptions="Center"
                           HeightRequest="50" WidthRequest="50" />

        <VerticalStackLayout x:Name="emptyState" Grid.Row="1"
                             IsVisible="False"
                             VerticalOptions="Center" HorizontalOptions="Center"
                             Spacing="8" Padding="30">
            <Label Text="&#x1F464;" FontSize="48" HorizontalTextAlignment="Center" />
            <Label Text="Nu exista inca membri in echipa" FontSize="18" FontAttributes="Bold"
                   TextColor="{StaticResource Gray600}" HorizontalTextAlignment="Center" />
            <Label Text="Apasa Adauga pentru a adauga un membru."
                   FontSize="14" TextColor="{StaticResource Gray400}" HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <RefreshView Grid.Row="1" x:Name="refreshView" Refreshing="OnRefreshing">
            <ListView x:Name="listView"
                      HasUnevenRows="True"
                      ItemSelected="OnItemSelected"
                      SeparatorVisibility="None"
                      BackgroundColor="Transparent">
                <ListView.ItemTemplate>
                    <DataTemplate>
                        <ViewCell>
                            <Frame Margin="12,6" Padding="0" CornerRadius="12"
                                   BackgroundColor="{StaticResource CardBackground}"
                                   BorderColor="Transparent" HasShadow="True">
                                <Grid Padding="16,14" ColumnDefinitions="Auto, *, Auto" ColumnSpacing="14">
                                    <Frame WidthRequest="44" HeightRequest="44" CornerRadius="22"
                                           Padding="0" BackgroundColor="{StaticResource PrimaryLight}"
                                           BorderColor="Transparent" VerticalOptions="Center">
                                        <Label Text="{Binding NumeComplet, Converter={StaticResource InitialsConverter}}"
                                               FontSize="16" FontAttributes="Bold"
                                               TextColor="{StaticResource PrimaryDark}"
                                               HorizontalOptions="Center" VerticalOptions="Center" />
                                    </Frame>
                                    <VerticalStackLayout Grid.Column="1" VerticalOptions="Center" Spacing="2">
                                        <Label Text="{Binding NumeComplet}" FontSize="16" FontAttributes="Bold"
                                               TextColor="{StaticResource Gray900}" />
                                        <Label Text="{Binding Email}" FontSize="13"
                                               TextColor="{StaticResource Gray500}" />
                                    </VerticalStackLayout>
                                    <VerticalStackLayout Grid.Column="2" VerticalOptions="Center" Spacing="2"
                                                         HorizontalOptions="End">
                                        <Frame Padding="8,3" CornerRadius="10"
                                               BackgroundColor="{StaticResource PrimaryLight}"
                                               BorderColor="Transparent">
                                            <Label Text="{Binding Rol, Converter={StaticResource RolToStringConverter}}" FontSize="11"
                                                   TextColor="{StaticResource PrimaryDark}" />
                                        </Frame>
                                        <Label Text="{Binding Seniority}" FontSize="11"
                                               TextColor="{StaticResource Gray400}"
                                               HorizontalTextAlignment="End" />
                                    </VerticalStackLayout>
                                </Grid>
                            </Frame>
                        </ViewCell>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>
        </RefreshView>
    </Grid>
</ContentPage>
